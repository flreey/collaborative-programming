// Generated by CoffeeScript 1.3.3

define(function(require, exports, module) {
  return {
    init: function(ace, io, project) {
      var session;
      this.ace = ace;
      this.editor = this.ace.edit('editor');
      this.editor.setShowPrintMargin(true);
      this.editor.setTheme("ace/theme/monokai");
      session = this.editor.getSession();
      session.setMode("ace/mode/javascript");
      session.setUseWrapMode(true);
      return this.asyn_server(io, project);
    },
    asyn_server: function(io, project) {
      var _this = this;
      io = io.connect("/project");
      return io.on('connect', function() {
        var e, emit_msg, s, sl;
        e = _this.editor;
        s = e.getSession();
        sl = e.selection;
        io.emit('join', project);
        emit_msg = false;
        $(document).keypress(function(event) {
          return emit_msg = true;
        });
        e.on('change', function(o) {
          console.log(emit_msg);
          if (emit_msg) {
            console.log(o);
            io.emit('change', {
              action: o.data.action,
              text: o.data.text
            });
            return emit_msg = false;
          }
        });
        e.on('changeSelection', function(o) {
          var acol, arow, lcol, lrow;
          arow = sl.anchor.row;
          acol = sl.anchor.column;
          lrow = sl.lead.row;
          lcol = sl.lead.column;
          if (arow !== lrow || acol !== lcol) {
            return io.emit('change_selection', {
              arow: arow,
              acol: acol,
              lrow: lrow,
              lcol: lcol
            });
          }
        });
        return io.on('insertText', function(data) {
          return e.insert(data);
        });
      });
    }
  };
});
